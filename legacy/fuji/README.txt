Still need some cleanup. I think I mixup tpye and vm at some point...
